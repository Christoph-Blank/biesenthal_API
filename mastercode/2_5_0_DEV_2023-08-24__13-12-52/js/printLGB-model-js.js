(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1979:function(t,f,b){"use strict";b.r(f),function(h,g,i,a){var t=b(18),d=b(1861),n=b(14),e=b(43),r=b(41),s=b(36),o=b(23),l=b(37),u=b(42),c=b(28),L=b(1),p=t.a.extend({defaults:h.extend({},t.a.prototype.defaults,{filename:"report",mapfishServiceId:void 0,printAppId:"master",layoutList:[],currentLayout:void 0,formatList:[],currentFormat:"pdf",currentPrintScale:0,currentMapScale:null,title:"PrintResult",isScaleSelectedManually:!1,isMetaDataAvailable:!1,isGfiAvailable:!1,isGfiSelected:!1,isGfiActive:!1,isLegendAvailable:!1,isLegendSelected:!1,isScaleAvailable:!1,plotServiceId:void 0,deactivateGFI:!1,renderToWindow:!0,glyphicon:"fas fa-print fa-lg",currentLng:"",titleLabel:"",titlePlaceholder:"",layoutLabel:"",formatLabel:"",scaleLabel:"",withLegendLabel:"",withInfoLabel:"",printLabel:"",layoutNameList:[],printLayoutElementsLabel:"Layout-Elemente",layoutListFiltered:"",currentDate:null,isPrintLayoutElementsSelected:!0,filterLayoutText:"",resolutionConfig:!1,printExtent:null,mapScaleLabel:"Kartenmaßstab",freeSelectionLabel:"Freie Auswahl",dpiList:null,currentDPI:null,printResolutionLabel:"",printResolutionList:[],customExtent:{},scaleInputType:"currentMapScale",currentListSelectionScale:null,standardResolution:"",highResolution:"",veryHighResolution:"",dpiListCategorized:[],requestErrorMessage:"",defaultLayoutName:"",excludeLayoutName:"",printErrorMessage:"",currentZoom:null}),initialize:function(t){var e=g.channel("Print");this.configuration=t,this.superInitialize(),this.listenTo(this,{"change:isActive":function(t,e){0===t.get("layoutList").length&&(this.getCapabilites(t,e),this.set("currentZoom",g.request("MapView","getZoomLevel")),g.trigger("Map","registerListener","moveend",this.handleMoveEvent.bind(this))),e&&this.initPrintExtentLayer(),e||g.request("Map","getLayerByName","printExtentLayer").setVisible(!1)},"change:isPrintLayoutElementsSelected":this.filterLayoutList,"change:currentPrintScale":function(t,e){this.updatePrintBBox(e)},"change:currentLayout":function(){this.updatePrintBBox(this.get("currentPrintScale"))},"change:currentPrintResolution":this.setPrintResolution}),this.listenTo(g.channel("MapView"),{changedOptions:function(t){this.set("currentMapScale",t.scale);var e=this.get("scaleInputType");this.get("isActive")&&"currentMapScale"===e&&this.set("currentPrintScale",t.scale)}}),this.listenTo(g.channel("GFI"),{isVisible:function(t){t||this.setIsGfiSelected(!1),this.setIsGfiActive(t)}}),e.on({createPrintJob:this.createPrintJob},this),this.createMapFishServiceUrl(this.get("mapfishServiceId")),this.listenTo(g.channel("i18next"),{languageChanged:this.changeLang}),this.changeLang(i.language),n.locale(this.get("currentLng")),this.set("currentDate",n().format("ll"))},changeLang:function(t){this.set({titleLabel:i.t("additional:printLGB.titleLabel"),titlePlaceholder:i.t("additional:printLGB.titlePlaceholder"),layoutLabel:i.t("additional:printLGB.layoutLabel"),formatLabel:i.t("additional:printLGB.formatLabel"),scaleLabel:i.t("additional:printLGB.scaleLabel"),withLegendLabel:i.t("additional:printLGB.withLegendLabel"),printLabel:i.t("additional:printLGB.printLabel"),withInfoLabel:i.t("additional:printLGB.withInfoLabel"),printResolutionLabel:i.t("additional:printLGB.printResolutionLabel"),standardResolution:i.t("additional:printLGB.standardResolution"),highResolution:i.t("additional:printLGB.highResolution"),veryHighResolution:i.t("additional:printLGB.veryHighResolution"),requestErrorMessage:i.t("additional:printLGB.requestErrorMessage"),printErrorMessage:i.t("additional:printLGB.printErrorMessage"),scaleText:i.t("additional:printLGB.scaleText"),printLayoutElementsLabel:i.t("additional:printLGB.printLayoutElementsLabel"),mapScaleLabel:i.t("additional:printLGB.mapScaleLabel"),freeSelectionLabel:i.t("additional:printLGB.freeSelectionLabel"),currentLng:t})},createMapFishServiceUrl:function(t){var e=g.request("RestReader","getServiceById",t),i=h.isUndefined(e)?"":e.get("url");this.setMapfishServiceUrl(i)},getCapabilites:function(t,e){var i;e&&void 0!==this.get("mapfishServiceId")&&(i=g.request("RestReader","getServiceById",this.get("mapfishServiceId")).get("url"),this.setMapfishServiceUrl(i),this.sendRequest(i+this.get("printAppId")+"/capabilities.json","GET",this.parseMapfishCapabilities,this.requestError))},parseMapfishCapabilities:function(t){this.setLayoutList(t.layouts),this.setDefaultLayout(),this.setIsMetaDataAvailable(!h.isUndefined(this.getAttributeInLayoutByName("metadata"))),this.setIsGfiAvailable(!h.isUndefined(this.getAttributeInLayoutByName("gfi"))),this.setIsLegendAvailable(!h.isUndefined(this.getAttributeInLayoutByName("legend"))),this.setIsScaleAvailable(!h.isUndefined(this.getAttributeInLayoutByName("scale"))),this.setFormatList(t.formats),this.set("dpiList",this.getDPIList()),this.set("dpiListCategorized",this.categorizeDPIList(this.getDPIList())),this.set("currentDPI",this.getDPIList()[0]),this.set("printMapScales",this.getPrintMapScales()),this.set("currentMapScale",g.request("MapView","getOptions").scale),this.setCurrentScale(this.get("currentMapScale")),this.set("currentListSelectionScale",this.get("printMapScales")[0]),0<this.get("filterLayoutText").length&&this.filterLayoutList()},setDefaultLayout:function(){var t=this.get("defaultLayoutName"),e=this.get("layoutListFiltered")||this.get("layoutList");0<t.length&&h.where(e,{name:t})[0]?this.setCurrentLayout(h.where(e,{name:t})[0]):this.setCurrentLayout(e[0])},print:function(){var t=g.request("Map","getLayers").getArray().filter(function(t){return!0===t.getVisible()&&"printExtentLayer"!==t.getProperties().name}),e=t.filter(function(t){return"WMS"===t.getProperties().typ}),i=[],n=[],r=null,a=null;if(e.forEach(function(t){i.push(t.getProperties().name)}),g.trigger("MapMarker","hideWktFeature"),r={layout:this.get("currentLayout").name,outputFilename:this.get("filename"),outputFormat:this.get("currentFormat"),attributes:{}},this.get("currentLayout").attributes.forEach(function(t){n.push(t.name)}),n.includes("map")&&(r.attributes.map={dpi:this.get("currentDPI"),projection:g.request("MapView","getProjection").getCode(),longitudeFirst:!0,bbox:this.get("printExtent")}),n.includes("title")&&(r.attributes.title=this.get("title")),n.includes("current_date")&&(r.attributes.current_date=this.get("currentDate")),n.includes("shown_services")&&(r.attributes.shown_services=i.toString()),n.includes("extent_coords_sw")){var s=this.get("printExtent")[0].toFixed(2).toString(),o=this.get("printExtent")[1].toFixed(2).toString();r.attributes.extent_coords_sw="E:"+s+", N:"+o}if(n.includes("extent_coords_no")){var l=this.get("printExtent")[2].toFixed(2).toString(),u=this.get("printExtent")[3].toFixed(2).toString();r.attributes.extent_coords_no="E:"+l+", N:"+u}a=new d.default(r),this.get("isMetaDataAvailable")&&a.setMetadata(!0),this.get("isLegendAvailable")&&(this.get("isLegendSelected")&&g.trigger("Legend","setLayerList"),a.buildLegend(this.get("isLegendSelected"),g.request("Legend","getLegendParams"),this.get("isMetaDataAvailable"))),this.get("isScaleAvailable")&&a.buildScale(this.get("currentPrintScale")),a.buildLayers(this.sortVisibleLayerListByZindex(t)),this.get("isGfiAvailable")&&a.buildGfi(this.get("isGfiSelected"),g.request("GFI","getGfiForPrint")),a=a.toJSON();var c=JSON.stringify(a,function(t,e){if(!this||"refFeature"!==t)return e});a=h.omit(a,"uniqueIdList"),this.createPrintJob(this.get("printAppId"),encodeURIComponent(c),this.get("currentFormat"))},sortVisibleLayerListByZindex:function(t){var e=h.filter(t,function(t){return!h.isUndefined(t.getZIndex())}),i=h.difference(t,e);return i.push(h.sortBy(e,function(t){return t.getZIndex()})),h.flatten(i)},createPrintJob:function(t,e,i){var n=this.get("mapfishServiceUrl")+t+"/report."+i;g.trigger("Util","showLoader"),this.sendRequest(n,"POST",this.waitForPrintJob,this.requestError,e)},waitForPrintJob:function(e){var t=this.get("mapfishServiceUrl")+"status/"+e.ref+".json";this.sendRequest(t,"GET",function(t){t.done?t.done&&"error"===t.status?(g.trigger("Util","hideLoader"),g.trigger("Alert","alert",{text:this.get("printErrorMessage")+" MapfishPrint Error: "+t.error,kategorie:"alert-warning"})):t.done&&"finished"===t.status&&(g.trigger("Util","hideLoader"),window.open(this.get("mapfishServiceUrl")+"report/"+e.ref)):this.waitForPrintJob(e)},this.requestError)},initPrintExtentLayer:function(){if(this.get("printExtentLayer")instanceof e.a)this.get("printExtentLayer").setVisible(!0),this.setCurrentScale(this.get("currentMapScale"));else{var t=new e.a({zIndex:1909,name:"printExtentLayer",source:new r.a,style:new o.c({fill:new l.a({color:"rgba(205, 205, 205, 0.7)"})})});g.trigger("Map","addLayer",t),this.set("printExtentLayer",t)}},updatePrintBBox:function(t,e){var i=g.request("Map","getLayerByName","printExtentLayer");h.isUndefined(e)&&(e=g.request("MapView","getCenter"));var n=this.calculatePrintExtent(t,e),r=i.getSource(),a=this.invertFeatureGeometry(n);this.set("printExtent",n),r.clear(),r.addFeature(a)},invertFeatureGeometry:function(t){var e=g.request("Map","getMap").getView().getProjection(),i=[new u.b([[[0,40],[0,60],[20,70],[20,40],[0,40]]]).transform("EPSG:4326",e.getCode()).getCoordinates()[0],[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]];return new s.a({geometry:new u.b(i)})},handleMoveEvent:function(){var t=this.get("currentZoom"),e=g.request("MapView","getZoomLevel"),i=t!==e,n=this.get("scaleInputType"),r=this.get("currentPrintScale");i&&this.set("currentZoom",e),"pickFromList"===n||"currentMapScale"===n&&!i?this.updatePrintBBox(r):"currentMapScale"===n&&i&&this.updatePrintBBox(this.get("currentMapScale"))},calculatePrintExtent:function(t,e){var i=this.getPrintMapSize(),n=t||this.get("currentPrintScale"),r=this.getPrintExtentSize(i,n);return[e[0]-r.width/2,e[1]-r.height/2,e[0]+r.width/2,e[1]+r.height/2]},getPrintExtentSize:function(t,e){var i=g.request("Map","getMap").getView().getProjection().getUnits(),n={degrees:4374754,ft:12,m:39.37},r=navigator.userAgent.toLowerCase(),a=/(ipad|tablet)/.test(r)?1:c.b;return{width:t.width/(72*a)/n[i]*e,height:t.height/(72*a)/n[i]*e}},getPrintMapSize:function(){var t=this.getAttributeInLayoutByName("map").clientInfo;return{width:t.width,height:t.height}},getDPIList:function(){return this.getAttributeInLayoutByName("map").clientInfo.dpiSuggestions},getPrintMapScales:function(){return this.getAttributeInLayoutByName("map").clientInfo.scales.sort(function(t,e){return t-e})},getAttributeInLayoutByName:function(e){return h.find(this.get("currentLayout").attributes,function(t){return t.name===e})},getLayoutByName:function(t,e){return h.find(t,function(t){return t.name===e})},sendRequest:function(t,e,i,n,r){a.ajax({url:g.request("Util","getProxyURL",t),type:e,data:r,crossDomain:!0,context:this,success:i,error:n})},requestError:function(t){this.set("isActive",!1),g.trigger("Alert","alert",{text:this.get("requestErrorMessage")+t.status+").",kategorie:"alert-danger"})},setLayoutList:function(t){this.set("layoutList",t)},setCurrentLayout:function(t){this.set("currentLayout",t)},setFormatList:function(t){var e=this.configuration.outputFormats||[],i=t;0<e.length&&0===(i=t.filter(function(t){return e.includes(t)})).length&&g.trigger("Alert","alert",{text:"Keine Ausgabeformate für den Druck verfügbar. Bitte überprüfen Sie den Filter der Formate auf gültige Eingaben.",kategorie:"alert-warning"}),this.set("formatList",i)},setCurrentFormat:function(t){this.set("currentFormat",t)},setCurrentScale:function(t){t===this.get("currentPrintScale")&&this.updatePrintBBox(t),this.set("currentPrintScale",t)},setIsLegendSelected:function(t){this.set("isLegendSelected",t)},setIsGfiAvailable:function(t){this.set("isGfiAvailable",t)},setIsGfiActive:function(t){this.set("isGfiActive",t)},setIsLegendAvailable:function(t){this.set("isLegendAvailable",t)},setIsScaleAvailable:function(t){this.set("isScaleAvailable",t)},setIsGfiSelected:function(t){this.set("isGfiSelected",t)},setIsMetaDataAvailable:function(t){this.set("isMetaDataAvailable",t)},setTitle:function(t){this.set("title",t)},setIsScaleSelectedManually:function(t){this.set("isScaleSelectedManually",t)},setMapfishServiceUrl:function(t){this.set("mapfishServiceUrl",t)},setEventListener:function(t){this.set("eventListener",t)},filterLayoutList:function(){var t=this.get("isPrintLayoutElementsSelected"),e=this.get("layoutList"),i=this.get("filterLayoutText"),n=this.get("excludeLayoutName"),r=[];r=!0===t?e.filter(function(t){return!t.name.toLowerCase().includes(i)&&!t.name.toLowerCase().includes(n)}):e.filter(function(t){return t.name.toLowerCase().includes(i)&&!t.name.toLowerCase().includes(n)}),this.set("layoutListFiltered",r),this.setDefaultLayout()},customExtent:function(){var t=this.get("customExtent"),e=g.request("Map","getLayerByName","printExtentLayer"),i=this.invertFeatureGeometry(t.bbox),n=e.getSource(),r=this.getClosestScaleToFitExtentFeature();this.set("printExtent",t.bbox),this.setCurrentScale(r),n.clear(),n.addFeature(i)},getClosestScaleToFitExtentFeature:function(){var i=this,n=this.get("customExtent"),t=this.getPrintMapScales(),r=Object(L.x)(n.bbox),a=t[0];return t.forEach(function(t){var e=i.calculatePrintExtent(t,r);Object(L.g)(e,n.bbox)&&(a=t)}),a},categorizeDPIList:function(t){var i=[];return t.forEach(function(t){var e={value:t,title:""};t<=140?e.title=t.toString().concat(" (",this.get("standardResolution"),")"):140<t&&t<300?e.title=t.toString().concat(" (",this.get("highResolution"),")"):300<=t&&(e.title=t.toString().concat(" (",this.get("veryHighResolution"),")")),i.push(e)}.bind(this)),i}});f.default=p}.call(this,b(3),b(4),b(24),b(10))}}]);